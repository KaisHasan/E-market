{% extends 'pages/_base.html' %}

{% load static %}
{% load crispy_forms_tags %}


{% block title %}Product Detail{% endblock title %}

{% block head_block %}
    <link rel='stylesheet' href="{% static 'products/css/product_detail.css' %}"
{% endblock head_block %}

{% block content %}
    <p>
        <a href="{{request.META.HTTP_REFERER}}">&larr; Go back </a>
    </p>
    <main>
        <div class='product-title'>
            <h1 class='product-name'> {{product.name}} </h1>
            <a class='add-to-cart' href="{% url 'add_item' product.pk %}">
                <img class='add-to-cart-button' src="{% static 'products/images/add_to_cart_button.png'%}" 
                    alt="Add to cart" />
            </a>
        </div>
        <ul class='product-detail-properties'>
            <li> Price: {{product.price}} </li>
            <li>Categories:
                {% for category in product.categories.all %}
                    [<a class='product-category' href="{% url 'category_products' category %}">
                        {{category}}
                    </a>] 
                {% empty %}
                    None.
                {% endfor %}
            </li>
            {% if user.is_authenticated %}
                <li>
                    <span>
                        {% if product.pk in starred_products %}
                            <span class='starred'>Starred</span> |
                            <a href="{% url 'star_unstar' product.pk %}?next={{ request.path|urlencode }}">
                                Remove from favorites </a>
                        {% else %}
                            <a href="{% url 'star_unstar' product.pk %}?next={{ request.path|urlencode }}">
                                Add to favorites </a>
                        {% endif %}
                    </span>
                    <br />
                </li>
            {% endif %}
        </ul>

        <img class='product-img' src="{% static 'products/images/new.jpg' %}" alt='new product' />

        
        
        <div class='compare'>
            <h2> Compare</h2>
            <form action="{% url 'compare' product.pk %}" method='GET'>
                {{compare_form|crispy}}
                <button type='submit'>Compare</button>
            </form>
            {% if show_compare %}
                <div class='compare-results'>
                    <table border="10px">
                        <tr>
                            <th></th>
                            <th>{{first_item.name}}</th>
                            <th>{{second_item.name}}</th>
                        </tr>
                        <tr>
                            <th>Price</th>
                            <td>{{first_item.price}}</td>
                            <td>{{second_item.price}}</td>
                        </tr>
                    </table>
                </div>
            {% endif %}
        </div>
        <div class='reviews'>
            <h2> Reviews </h2>
            {% if user.is_authenticated and user_not_posted_review %}
                <p> <a href="{% url 'add_review' product.pk %}"> Add review </a> </p>
            {% endif %}
            {% for review in reviews %}
                <p id='{{ review.pk }}'  class='review-item'>
                    <b>User:</b> {{review.user}}
                    <br />
                    <b>stars:</b> {{review.stars}}
                    <br />
                    <b>comment:</b>
                    <br />
                    <span class='comment'>{{review.comment}}</span>
                    <br />
                    <br />
                    <a href="{% url 'delete_review' review.pk %}"> Delete </a>|
                    <a href="{% url 'edit_review' product.pk review.pk %}"> Edit </a>
                    <br />
                    <br />
                </p>
            {% empty %}
                <p> No reviews yet. </p>
            {% endfor %}
        </div>

    </main>
{% endblock content %}